jQuery(document).ready(function(e){e("#chat-form").submit(function(t){t.preventDefault();if(e(this).hasClass("loading"))return!1;var n=e(this).find("textarea"),r=n.val(),i=e(".chat-container li:first");if(r.length){e(this).addClass("loading");i.length&&e(this).find("input[name=newest]").val(i.attr("data-chat-id"));e(this).ajaxSubmit({success:function(t){e("#chat-form").removeClass("loading");if(t.success){n.val("");e(".chat-container").prepend(t.message).effect("highlight")}else alert(t.message)}})}});e("#chat-form textarea").keydown(function(t){var n=t.keyCode||t.which;if(n==13&&(t.ctrlKey||t.metaKey)){t.preventDefault();e("#chat-form").submit()}});setInterval(function(){if(!e("#chat-form").hasClass("loading")&&!e(".prev-loader").hasClass("active")){e(".prev-loader").addClass("active");var t=e(".chat-container li:first").attr("data-chat-id"),n=e("#_wp_gianism_nonce").val(),r=e("#chat-form input[name=thread_id]").val();e.post(e("#chat-form").attr("action"),{action:"gianism_chat_newer",_wp_gianism_nonce:n,thread_id:r,newest:t},function(t){e(".prev-loader").removeClass("active");t.success?t.message&&e(".chat-container").prepend(t.message):alert(t.message)},"json")}},8e3);var t=function(t){var n=e('<p class="message-box">'+t+"</p>");e("#chat-more").before(n);n.effect("highlight",{duration:1e3}).delay(5e3).fadeOut(1e3,function(){e(this).remove()})};e("#chat-more").click(function(n){n.preventDefault();if(e(this).hasClass("disabled"))return!1;var r=e(this),i=e(this).attr("data-thread-id"),s=e(this).attr("data-action"),o=e(".chat-container li:last").attr("data-chat-id"),u=e(this).attr("data-nonce"),a=e(this).prev(".loader");a.fadeIn();e(this).addClass("disabled");e.post(e(this).attr("href"),{action:s,_wp_gianism_nonce:u,thread_id:i,oldest:o},function(n){a.fadeOut(1e3,function(){});r.removeClass("disabled");if(n.success)if(!n.html){t(n.message);a.remove();r.remove()}else for(var i=0,s=n.html.length;i<s;i++)e(n.html[i]).appendTo(".chat-container").effect("highlight",{duration:1e3});else t(n.message)},"json")})});